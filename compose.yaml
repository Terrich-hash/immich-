version: "3.8"

services:
  immich:
    image: ghcr.io/immich-app/immich-server:release
    container_name: immich
    command: ["start.sh", "immich"]
    env_file:
      - .env
    volumes:
      - /srv/immich/upload:/usr/src/app/upload
    restart: unless-stopped

  tailscale:
    image: tailscale/tailscale:stable
    container_name: immich-tailscale
    network_mode: "service:immich"
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    volumes:
      - ./ts-state:/var/lib/tailscale
      - /dev/net/tun:/dev/net/tun
    command: tailscaled
    restart: unless-stopped
